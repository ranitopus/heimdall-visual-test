# 1. When Cypress config file in a consumer project tries to use `.js` files from `heimdall-visual-test`, it breaks the Cypress startup.

## Status: `SOLVED`

## Explanation and reproduction
- To see this happening, you only have to: Add this dependency in your project at version 0.1.0 or below, have Cypress as testing suite for your project, and try to import the JavaScript contents here in the Cypress configuration file there using `require()`.

## How is it solved
- It started because this project didn't have the `"type": "module"` set on `package.json` yet. The JavaScript config file for Cypress is by default treated as CommonJS; The `require()` import pattern that is used in it didn't accept ES Module syntax in files that weren't explicitly with `.mjs` extension. Putting the `"type": "module"` on `package.json` here in this project solved this part.
- Next, even with the `"type": "module"` on `package.json`, the `require()` import pattern on the consumer side didn't work for importing ES Modules; The recommended/required action from the compiler was for the consumer side to use dynamic imports (`import()`) to fetch the `heimdall-visual-test` content (which, of course, is cleaner with an `await import()` pattern, which means that it worked better inside of an `async` scope).
> Before the fix:
> ```js
> // in the cypress.config.js file, on the consumer side
> const visualTestingTasks = require('heimdall-visual-test/src/cypress/taskHandlers')
> // (...)
> module.exports = defineConfig({
>   // (...)
>   e2e: {
>     // (...)
>     setupNodeEvents(on, config) {
>       // (...)
>       on('task', {...visualTestingTasks(config)})
>     }
>   }
> })
> ```
> ---
> After the fix:
> ```js
> // in the cypress.config.js file, on the consumer side
> // (...)
> module.exports = defineConfig({
>   // (...)
>   e2e: {
>     // (...)
>     async setupNodeEvents(on, config) {
>       // (...)
>       const visualTestingTasks = (await import('heimdall-visual-test/src/cypress/taskHandlers')).default
>       on('task', {...visualTestingTasks(config)})
>     }
>   }
> })
> ```
- Then, one last thing was changing the path to access the wanted content from modules on `heimdall-visual-test`; The dynamic import only worked when the path to the module ended with `.js`. Also, recursively, any internal imports that didn't end with `.js` made the Cypress startup fail. Those needed to be changed here in this project as well.
